<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>All Registered Users</title>
<style>
  body{
    margin:0;height:100vh;background:linear-gradient(135deg,#030305,#121214);
    color:#fff;display:flex;align-items:center;justify-content:center;
    font-family:Inter,system-ui
  }
  .bg{position:fixed;inset:0;opacity:.04;
    background-image:url('https://cryptologos.cc/logos/bitcoin-btc-logo.png');
    background-repeat:repeat;background-size:120px;
    animation:move 25s linear infinite}
  @keyframes move{from{background-position:0 0}to{background-position:1500px 1500px}}
  .card{
    background:rgba(255,255,255,.05);border-radius:12px;
    padding:18px;width:440px;height:480px;overflow-y:auto;
    backdrop-filter:blur(6px);box-shadow:0 0 25px rgba(0,0,0,.7)
  }
  h2{color:#f0c24b;margin-top:0;text-align:center}
  .row{
    padding:10px;border-bottom:1px dashed rgba(255,255,255,.1);
    display:flex;justify-content:space-between;align-items:center
  }
  .small{font-size:13px;color:#ccc}
  .bal{color:#b9f6c1;font-weight:700}
  .inr{color:#9ef;font-size:13px}
  button{
    background:#f0c24b;border:0;padding:4px 8px;border-radius:6px;
    font-weight:600;color:#000;cursor:pointer
  }
  .rate{
    color:#9ef;font-size:13px;text-align:center;margin-bottom:8px;
  }
</style>
</head>
<body>
<div class="bg"></div>
<div class="card">
  <h2>All Registered Users</h2>
  <p class="rate" id="rateText">Loading rate...</p>
  <div id="rows"></div>
</div>

<script>
function loadUsers(){ try{return JSON.parse(localStorage.getItem('btc_users')||'[]')}catch(e){return[]} }
function saveUsers(u){ localStorage.setItem('btc_users', JSON.stringify(u)) }

let rateINR = 0;
async function fetchRate(){
  try{
    const res = await fetch('https://api.coindesk.com/v1/bpi/currentprice/INR.json');
    const data = await res.json();
    rateINR = data.bpi.INR.rate_float;
    document.getElementById('rateText').textContent = 
      `Live Rate: 1 BTC = ₹${rateINR.toLocaleString('en-IN')}`;
  }catch(e){
    rateINR = 9000000;
    document.getElementById('rateText').textContent = 
      `Offline Rate Used: 1 BTC = ₹${rateINR.toLocaleString('en-IN')}`;
  }
  renderList();
}
fetchRate();

/* render users */
const rows=document.getElementById('rows');
function renderList(){
  const users=loadUsers();
  rows.innerHTML='';
  users.forEach((u,i)=>{
    const btcBal = (u.balance || 0);
    const inrBal = btcBal * rateINR;

    const div=document.createElement('div');
    div.className='row';
    div.innerHTML=`
      <div>
        <div>${u.fname} ${u.lname}</div>
        <div class="small">${u.role} • ${u.mobile}</div>
      </div>
      <div style="text-align:right">
        <div class="bal">${btcBal.toFixed(4)} ₿</div>
        <div class="inr">₹${inrBal.toLocaleString('en-IN')}</div>
        <div class="small">${u.accountNo}</div>
        ${u.role === 'Employee' ? `<button onclick="addINR(${i})">+ INR</button>` : ''}
      </div>`;
    rows.appendChild(div);
  });
}

/* Add INR -> convert to BTC -> update balance */
function addINR(index){
  const users = loadUsers();
  const emp = users[index];
  const inr = parseFloat(prompt(`Enter INR to add for ${emp.fname} ${emp.lname}:`));
  if(isNaN(inr) || inr<=0){ alert('Invalid amount'); return; }

  const btc = inr / rateINR;
  emp.balance = (emp.balance || 0) + btc;

  saveUsers(users);
  alert(`₹${inr.toLocaleString('en-IN')} converted to ${btc.toFixed(6)} BTC and added.`);
  renderList();
}

renderList();
</script>
</body>
</html>
