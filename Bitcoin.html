<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>BTC ⇄ INR Converter</title>
<style>
  :root{--bg:#0b0b0b;--glass:rgba(255,255,255,.06);--gold:#f0c24b}
  *{box-sizing:border-box;font-family:Inter,system-ui,Arial}
  body{
    margin:0;height:100vh;display:flex;align-items:center;justify-content:center;
    background:linear-gradient(135deg,#050506,#141416 70%);
    color:#fff;overflow:hidden;
  }
  .bg{position:fixed;inset:0;opacity:.04;background-image:url('https://cryptologos.cc/logos/bitcoin-btc-logo.png');
    background-repeat:repeat;background-size:120px;animation:move 25s linear infinite}
  @keyframes move{from{background-position:0 0}to{background-position:1500px 1500px}}
  .card{width:380px;padding:24px;border-radius:14px;background:var(--glass);
    box-shadow:0 6px 30px rgba(0,0,0,.7);backdrop-filter:blur(6px);}
  h2{color:var(--gold);margin:0 0 12px;text-align:center}
  input,button{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:0;
    background:rgba(255,255,255,.06);color:#fff;text-align:center;}
  button{background:var(--gold);color:#000;font-weight:700;cursor:pointer}
  .msg{text-align:center;font-size:14px;margin-top:6px;height:18px;}
  .rate{color:#9ef;font-size:13px;text-align:center;margin-top:6px;}
  .bal{font-size:14px;color:#b9f6c1;text-align:center;margin-top:4px;}
</style>
</head>
<body>
  <div class="bg"></div>
  <div class="card">
    <h2>BTC ⇄ INR Converter</h2>

    <input id="accNo" placeholder="Enter Employee Account Number">
    <button id="btnFind">Find Employee</button>

    <div id="empDetails" style="display:none;">
      <p><b>Name:</b> <span id="empName"></span></p>
      <p><b>BTC Balance:</b> <span id="btcBal"></span> ₿</p>
      <p><b>INR Balance:</b> ₹<span id="inrBal"></span></p>
      <p class="rate" id="rateText"></p>
      <hr>

      <h3>Bitcoin → INR</h3>
      <input id="btcInput" placeholder="Enter Bitcoin amount">
      <button id="btnToINR">Convert & Transfer</button>
      <div class="msg" id="msgBTC"></div>

      <h3>INR → Bitcoin</h3>
      <input id="inrInput" placeholder="Enter INR amount">
      <button id="btnToBTC">Convert & Transfer</button>
      <div class="msg" id="msgINR"></div>
    </div>

    <div class="msg" id="msg"></div>
  </div>

<script>
/* --- storage helpers --- */
function loadUsers(){ try { return JSON.parse(localStorage.getItem('btc_users')||'[]') } catch(e){return []} }
function saveUsers(u){ localStorage.setItem('btc_users', JSON.stringify(u)) }

/* --- live BTC-INR rate --- */
let rateINR = 0;
async function fetchRate(){
  try{
    const res = await fetch('https://api.coindesk.com/v1/bpi/currentprice/INR.json');
    const data = await res.json();
    rateINR = data.bpi.INR.rate_float;
    document.getElementById('rateText').textContent = `1 BTC = ₹${rateINR.toLocaleString('en-IN')}`;
  }catch(e){
    rateINR = 9000000; // fallback
    document.getElementById('rateText').textContent = `Using offline rate 1 BTC = ₹${rateINR.toLocaleString('en-IN')}`;
  }
}
fetchRate();
setInterval(fetchRate, 30000); // auto refresh every 30s

/* --- find employee --- */
let currentEmp=null;
document.getElementById('btnFind').addEventListener('click', ()=>{
  const acc = document.getElementById('accNo').value.trim();
  const msg = document.getElementById('msg');
  if(!acc){ msg.style.color='salmon'; msg.textContent='Enter account number'; return; }

  const users = loadUsers();
  const emp = users.find(u=>u.accountNo===acc && u.role==='Employee');
  if(!emp){ msg.style.color='salmon'; msg.textContent='Employee not found'; return; }

  // Ensure INR balance exists
  if(typeof emp.inrBalance!=="number") emp.inrBalance = 0;

  msg.textContent='';
  document.getElementById('empDetails').style.display='block';
  document.getElementById('empName').textContent = emp.fname + ' ' + emp.lname;
  document.getElementById('btcBal').textContent = emp.balance.toFixed(4);
  document.getElementById('inrBal').textContent = emp.inrBalance.toLocaleString('en-IN');
  currentEmp = emp;
});

/* --- BTC → INR --- */
document.getElementById('btnToINR').addEventListener('click', ()=>{
  if(!currentEmp){ return alert('Find an employee first!'); }
  const amt = parseFloat(document.getElementById('btcInput').value);
  const msg = document.getElementById('msgBTC');
  if(isNaN(amt) || amt<=0){ msg.style.color='salmon'; msg.textContent='Enter valid BTC amount'; return; }
  if(currentEmp.balance < amt){ msg.style.color='salmon'; msg.textContent='Insufficient BTC balance'; return; }

  const inr = amt * rateINR;
  currentEmp.balance -= amt;
  currentEmp.inrBalance += inr;

  updateUser(currentEmp);
  msg.style.color='#b9f6c1';
  msg.textContent = `${amt} BTC → ₹${inr.toLocaleString('en-IN')} transferred!`;
  refreshDisplay();
});

/* --- INR → BTC --- */
document.getElementById('btnToBTC').addEventListener('click', ()=>{
  if(!currentEmp){ return alert('Find an employee first!'); }
  const amt = parseFloat(document.getElementById('inrInput').value);
  const msg = document.getElementById('msgINR');
  if(isNaN(amt) || amt<=0){ msg.style.color='salmon'; msg.textContent='Enter valid INR amount'; return; }
  if(currentEmp.inrBalance < amt){ msg.style.color='salmon'; msg.textContent='Insufficient INR balance'; return; }

  const btc = amt / rateINR;
  currentEmp.inrBalance -= amt;
  currentEmp.balance += btc;

  updateUser(currentEmp);
  msg.style.color='#b9f6c1';
  msg.textContent = `₹${amt.toLocaleString('en-IN')} → ${btc.toFixed(6)} BTC transferred!`;
  refreshDisplay();
});

/* --- save + refresh display --- */
function updateUser(emp){
  const users = loadUsers();
  const idx = users.findIndex(u=>u.accountNo===emp.accountNo);
  if(idx>-1){ users[idx]=emp; saveUsers(users); }
}
function refreshDisplay(){
  document.getElementById('btcBal').textContent = currentEmp.balance.toFixed(4);
  document.getElementById('inrBal').textContent = currentEmp.inrBalance.toLocaleString('en-IN');
}
</script>
</body>
</html>
